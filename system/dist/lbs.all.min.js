var lbs=lbs||{debug:!1,verboseLevel:null,limeDataConnection:window.external,limeVersion:{},hasLimeConnection:!0,activeClass:"",activeDatabase:"",activeServer:"",activeInspector:"",wrapperType:"actionpad",apps:{},error:!1,vm:{},loading:{},config:{dataSources:[{type:"activeInspector",source:""},{type:"localization",source:""}],resources:{scripts:[],styles:[],libs:["json2xml.js","moment.min.js"]},autorefresh:!1},setup:function(){this.setSystemOperationParameters(),this.debug=lbs.externalConfig.debug,lbs.SetTouchEnabled(!1),window.console.log=lbs.log.log,this.setVerboseLevel(),this.log.setup(lbs.debug),this.setActionPadEnvironment(),this.setupLoader(),this.processConfiguration(),this.setActiveDBandServer(),this.setSkin(),moment.lang(lbs.common.executeVba("Localize.GetLanguage")),this.vm=lbs.loader.loadDataSources(this.vm,this.config.dataSources,!1),this.log.watch.setup(),this.loader.loadView("system/view/{0}".format(lbs.wrapperType),$("#wrapper")),this.loader.loadView(lbs.activeClass,$("#content")),this.apploader.buildCarousel(),this.apploader.identifyApps(),this.loader.loadResources(),this.apploader.buildApps(),this.applyContentBindings(),this.apploader.initializeApps(),this.log.vm.enableConsole(),this.ExecuteOnloadEvents(),this.SetJqEvents(),this.checkForUpdates(),lbs.loading.showLoader(!1),lbs.jotnar.winterEgg(),lbs.log.watch.sh()},processConfiguration:function(){this.config=lbs.loader.loadExternalConfig(this.config,this.externalConfig.config,this.activeClass)},setupLoader:function(){this.loader.loadView("system/view/loader",$("#loadingIndicator")),lbs.loading.showLoader=ko.observable(!0),lbs.loading=ko.mapping.fromJS(lbs.loading),ko.applyBindings(lbs.loading,$("#loadingIndicator").get(0))},setSystemOperationParameters:function(){$.ajaxSetup({async:!1}),this.vm=new lbs.vmFactory,this.hasLimeConnection="undefined"!=typeof lbs.limeDataConnection.Application,this.limeVersion=lbs.common.parseVersion(lbs.hasLimeConnection?lbs.limeDataConnection.Version:"0.0.0")},setDebug:function(e){lbs.debug=e},setVerboseLevel:function(){if(lbs.externalConfig.verboseLevel)switch(lbs.externalConfig.verboseLevel){case"debug":lbs.verboseLevel=lbs.log.verboseLevelEnum.debug;break;case"info":lbs.verboseLevel=lbs.log.verboseLevelEnum.info;break;case"warn":lbs.verboseLevel=lbs.log.verboseLevelEnum.warn;break;case"error":lbs.verboseLevel=lbs.log.verboseLevelEnum.error;break;default:lbs.verboseLevel=lbs.log.verboseLevelEnum.warn}else lbs.verboseLevel=lbs.log.verboseLevelEnum.warn},setActionPadEnvironment:function(){var e=null,o=null,a=null;if(lbs.hasLimeConnection)try{e=lbs.common.getURLParameter("apowner"),null!==e?"inspector"==e?(a=lbs.common.getURLParameter("apownerid"),a&&(o=lbs.limeDataConnection.Inspectors.Lookup(a))):(e="application")&&(o=null):o=lbs.limeDataConnection.ActiveInspector,o?(lbs.activeInspector=o,lbs.activeClass=o["class"].Name):(lbs.activeInspector=null,lbs.activeClass="index")}catch(t){lbs.log.warn("Could not determine inspector class, assuming index",t),lbs.activeClass="index"}null!==lbs.common.getURLParameter("ap")&&(this.activeClass=lbs.common.getURLParameter("ap")),null!==lbs.common.getURLParameter("sv")&&(this.activeClass="system/view/{0}".format(lbs.common.getURLParameter("sv")));try{if(wrapperType=lbs.common.getURLParameter("type"),null!==wrapperType)switch(wrapperType){case"tab":lbs.wrapperType="wrapperTab";break;case"inline":lbs.wrapperType="wrapperInline";break;default:lbs.wrapperType="wrapperActionpad"}else lbs.wrapperType="wrapperActionpad"}catch(t){lbs.log.error("Could not determine wrapper type",t)}lbs.log.info("Using wrapper type: "+lbs.wrapperType),lbs.log.info("Using view: "+lbs.activeClass)},setActiveDBandServer:function(){try{lbs.activeServer=lbs.limeDataConnection.Database.ActiveServerName,lbs.activeDatabase=lbs.limeDataConnection.Database.Name,lbs.log.info("Active Server, Database: "+lbs.activeServer+", "+lbs.activeDatabase)}catch(e){lbs.log.warn("Could not set active server and database")}},setSkin:function(){try{var e=lbs.hasLimeConnection?lbs.limeDataConnection.application.Theme:1;1==e?(lbs.log.info("Silver skin is used"),$("body").addClass("silver")):2==e&&(lbs.log.info("Skin: I'm Britney bitch!"),$("body").addClass("britney"))}catch(o){lbs.log.warn("Could not set the skin")}},SetJqEvents:function(){$(".expandable").find(".menu-header").click(function(){var e=$(this).parent();$(this).find("i").first().toggleClass("fa fa-angle-down"),$(this).find("i").first().toggleClass("fa fa-angle-right"),e.hasClass("collapsed")?(e.removeClass("collapsed"),e.children("li").not(".remainHidden").fadeIn(200),e.find(":hidden").removeClass("remainHidden")):(e.addClass("collapsed"),e.find(":hidden").addClass("remainHidden"),e.children("li").not(".menu-header").not(".divider").fadeOut(200))})},GlobalEventHandler:{OnKeydown:function(e,o){if(o.ctrlKey&&o.shiftKey&&82==o.which)location.reload();else if(o.ctrlKey&&o.shiftKey&&87==o.which)lbs.log.watch.show("WATCH");else{if(!o.ctrlKey||!o.shiftKey||76!=o.which)return!0;lbs.log.watch.show("LOG")}}},SetTouchEnabled:function(e){$("html").attr("oncontextmenu","return {0}".format(e?"true":"false")),$("html").toggleClass("notouch",!e)},ExecuteOnloadEvents:function(){$(".expandable").each(function(){$(this).hasClass("collapsed")?($(this).find(":hidden").addClass("remainHidden"),$(this).find(".menu-header").prepend("<i class='fa fa-angle-right'> </i>"),$(this).children("li").not(".menu-header").not(".divider").hide()):$(this).find(".menu-header").prepend("<i class='fa fa-angle-down'> </i>")}),$(".header-icon").each(function(){$(this).addClass("header-icon-container"),$(this).css("background-image","url('resources/"+lbs.activeClass+".png')")}),$("body").on("click",function(e){"popover"!==$(e.target).data("toggle")&&0===$(e.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")}),$(".carousel").carousel().on("slide.bs.carousel",function(e){var o=$(e.relatedTarget).height();$(this).find(".active.item").parent().animate({height:Math.max(o,$(e.currentTarget).height())},500)})},applyContentBindings:function(){ko.punches.interpolationMarkup.enable(),ko.punches.attributeInterpolationMarkup.enable(),ko.punches.textFilter.enableForBinding("text");try{ko.applyBindings(lbs.vm,$("#content").get(0))}catch(e){lbs.log.warn("Binding of data ActionPad failed! \n Displaying mapping attributes",e)}try{ko.applyBindings(lbs.vm,$("body").get(0))}catch(e){lbs.log.warn("Binding of body bindings failed!",e)}},checkForUpdates:function(){if(lbs.debug&&lbs.hasLimeConnection){var e="http://limebootstrap.lundalogik.com/api/";$.each(lbs.apps,function(o,a){try{var t=a.name,n=$.parseJSON(lbs.loader.loadFromExternalWebService(e+"apps/"+t+"/"));if(!n)return void lbs.log.warn("Failed to check remote version of app: '"+t+"'");if(n.error)return void lbs.log.warn("Failed to check remote version of app: '"+t+"'. Reason: "+n.error);var s=n.info.versions,r=lbs.loader.loadLocalFileToString("apps/"+t+"/app.json");if(""===r)return void lbs.log.warn("Failed to check local version of app: "+t,d);var l=$.parseJSON(r).versions,i=_.max(s,function(e){return e.version}).version,c=_.max(l,function(e){return e.version}).version;parseFloat(c)<parseFloat(i)?(lbs.log.warn("App "+t+" has an available update. Installed version: "+c+", Available version: "+i),lbs.log.vm.addAppUpdate({appName:t,remoteVersion:i,localVersion:c})):lbs.log.info("App "+t+" is up to date (version: "+c+")")}catch(d){lbs.log.warn("Failed to check version of app: "+t,d)}});try{var o=lbs.loader.loadFromExternalWebService(e+"version/");if(!o)return void lbs.log.warn("Failed to check remote version of LBS! ");var a=$.parseJSON(o),t=$.parseJSON(lbs.loader.loadLocalFileToString("system/version.json")),n=_.max(a.versions,function(e){return e.version}).version,s=_.max(t.versions,function(e){return e.version}).version;n>s?(lbs.log.vm.showUpgrade(!0),lbs.log.vm.showLBSVersion(!0),lbs.log.vm.remoteVersion(" v{0}-> v{1}".format(s,n)),lbs.log.warn("Your LIME Bootstrap is out of date! v{0}->v{1}".format(s,n))):lbs.log.info("LBS version: v{0}".format(s))}catch(r){lbs.log.warn("Failed to check version of LBS! ",r)}}}};lbs.vmFactory=function(){},$(document).ready(function(){window.lbs=lbs,lbs.setup()}),lbs.log={vm:null,verboseLevelEnum:{debug:3,info:2,warn:1,error:0},setup:function(e){lbs.loader.loadView("system/view/debug",$("#debug")),this.vm=new lbs.log.vmFactory(e),ko.applyBindings(this.vm,$("#debug").get(0))},logToDom:function(e,o){lbs.log.vm&&lbs.log.vm.addEntry(e.toUpperCase(),o)},logToConsole:{debug:function(e){try{console.debug(e)}catch(o){}},info:function(e){try{console.info(e)}catch(o){}},warn:function(e){try{console.warn(e)}catch(o){}},error:function(e){lbs.error=!0,lbs.log.vm.errorFound(!0),lbs.SetTouchEnabled(!0);try{console.error(e)}catch(o){}}},log:function(){lbs.log.logToConsole.debug(arguments);for(var e=0;e<arguments.length;e++)arguments[e]=Array.isArray(arguments[e])?ko.toJSON(arguments[e],null,0):"object"==typeof arguments[e]?ko.toJSON(arguments[e],void 0,4):arguments[e].toString(),lbs.log.logToDom("LOG",lbs.common.nl2brIndent(arguments[e]))},debug:function(e){lbs.verboseLevel>=lbs.log.verboseLevelEnum.debug&&(lbs.log.logToDom("DEBUG",lbs.common.nl2brIndent(e)),lbs.log.logToConsole.debug(e))},info:function(e){lbs.verboseLevel>=lbs.log.verboseLevelEnum.info&&(lbs.log.logToDom("INFO",lbs.common.nl2brIndent(e)),lbs.log.logToConsole.info(e))},warn:function(e,o){lbs.verboseLevel>=lbs.log.verboseLevelEnum.warn&&(o&&lbs.log.exception(o,"WARN"),lbs.log.logToDom("WARN",lbs.common.nl2brIndent(e)),lbs.log.logToConsole.warn(e))},error:function(e,o){o&&lbs.log.exception(o),lbs.log.logToDom("ERROR",lbs.common.nl2brIndent(e)),lbs.log.logToConsole.error(e)},exception:function(e,o){lbs.verboseLevel>=lbs.log.verboseLevelEnum.error&&(e&&lbs.log.exception(e),lbs.log.logToDom("ERROR",lbs.common.nl2brIndent(msg)),lbs.log.logToConsole.error(msg))}},lbs.log.vmFactory=function(e){var o=this;this.maxNbrOfItems=30,this.logItems=ko.observableArray([]),this.enabled=ko.observable(e),this.delayedLogItems=[],this.delayedLoggingEnabled=!0,this.showUpgrade=ko.observable(!1),this.appUpdates=ko.observableArray(),this.showLBSVersion=ko.observable(!1),this.remoteVersion=ko.observable(),this.errorFound=ko.observable(!1),this.addAppUpdate=function(e){o.showUpgrade(!0),o.appUpdates.push(e)},this.enableConsole=function(){this.delayedLoggingEnabled=!1,this.pushDelayedLogItems()},this.addEntry=function(e,o){switch(ico="icon-exclamation",rowclass="alert alert-info",e){case"DEBUG":ico="fa fa-cog",rowclass="alert alert-info";break;case"INFO":ico="fa fa-info-circle",rowclass="alert alert-info";break;case"WARN":ico="fa fa-warning",rowclass="alert alert-warning";break;case"LOG":ico="fa fa-paw",rowclass="alert alert-success";break;case"ERROR":ico="fa fa-times-circle",rowclass="alert alert-danger",this.enabled(!0)}this.delayedLoggingEnabled?this.delayedLogItems.push({level:e,text:o,icon:ico,liclass:rowclass}):(this.logItems().length>=this.maxNbrOfItems&&this.logItems.shift(),this.logItems.push({level:e,text:o,icon:ico,liclass:rowclass}))},this.pushDelayedLogItems=function(){var e;for(e in this.delayedLogItems)this.logItems.push(this.delayedLogItems[e])}},lbs.log.watch={show:function(e){var o=new lbs.log.watch.vmFactory;""!==e&&(o.initState=e);showModalDialog("lbs.html?sv=watch&&type=tab",o,"status:false;dialogWidth:900px;dialogHeight:800px;resizable:Yes")},setup:function(){if("system/view/watch"==lbs.activeClass&&window.dialogArguments){lbs.log.vm.enabled(!1),lbs.SetTouchEnabled(!0);var e=window.dialogArguments,o=new lbs.log.watch.vmFactory;o.vms=e.vms,o.logItems=e.logItems,o.initState=e.initState,o.dom=e.dom,vm=lbs.common.mergeOptions(lbs.vm,o||{},!0),o.selectState(o.initState),o.selectVm(o.vms[0]),$("body").keypress(function(e){27==e.which&&window.close()})}},sh:function(){$("pre code").each(function(e,o){hljs.highlightBlock(o)})},vmFactory:function(){var e=this;e.selectedVm=ko.observable({name:"",vm:{}}),e.vms=[],e.logItems=[],e.selectedState=ko.observable("LOG"),e.states=["LOG","WATCH","DOM"],e.initState="LOG",e.searchValue=ko.observable().extend({throttle:50}),e.logView=ko.observable("SHOW ALL"),e.logStatus=["LOG"];var o="";e.counter=ko.observable(0),e.order=ko.observable(0),e.prettyVm=ko.computed(function(){return o="",e.searchValue(""),JSON.stringify(e.selectedVm().vm,null,2)}),$("body").keypress(function(o){13==o.which&&e.goToNext()}),e.searchValue.subscribe(function(a){var t=a.toLowerCase();if(e.order(0),t.length>1){var n=new RegExp(t,"g"),s=$("#vmData").html();""===o?o=s:$("#vmData").html(o),e.counter(e.replaceText($("#vmData"),n,t,a)),e.goToNext()}else e.counter(0),$("#vmData").html(""==o?$("#vmData").html():o)}),e.goToNext=function(){if(e.order()<e.counter()&&e.counter()>0){var o="#"+e.order();if($(o).length>0){$("#watchContainer").animate({scrollTop:$(o).offset().top+$("#watchContainer").scrollTop()},200);var a="#"+(e.order()-1).toString(16);$(a).hasClass("highlight-grey")&&$(a).removeClass("highlight-grey").addClass("highlight-yellow"),$(o).addClass("highlight-grey"),e.order(e.order()+1)}}else e.order(0),e.goToNext()},e.replaceText=function(e,o,a,t){var n=0;return $(e).find("span").each(function(){if(($(this).hasClass("hljs-string")||$(this).hasClass("hljs-number")||$(this).hasClass("hljs-attribute"))&&$(this).text().toLowerCase().indexOf(a)>-1){var e=$(this).text().toLowerCase().replace(o,"<span id="+n+' class="highlight-yellow">'+t+"</span>");n+=1,$(this).html(e)}}),n},e.selectVm=function(o){e.selectedVm(o),lbs.log.watch.sh()},e.selectState=function(o){e.selectedState(o)},e.selectedLogStatus=function(o){e.logView(o)};var a=$.map(lbs.apps,function(e,o){return{name:e.name,vm:e.vm||{}}});e.vms.push({name:"Actionpad",vm:lbs.vm}),e.vms=e.vms.concat(a),e.logItems=ko.toJS(lbs.log.vm.logItems),e.dom=$("#wrapper").get()[0].outerHTML}},lbs.loader={systemLibPath:"system/",scripts:[],styles:[],libs:[],pushResources:function(e,o){var a;"undefined"!=typeof e&&($.each(e.scripts,function(t){a="/"==o?lbs.loader.systemLibPath+"js/":o,lbs.loader.scripts.push(a+e.scripts[t])}),$.each(e.libs,function(o){a=lbs.loader.systemLibPath+"js/",lbs.loader.libs.push(a+e.libs[o])}),$.each(e.styles,function(t){a="/"==o?lbs.loader.systemLibPath+"css/":o,lbs.loader.styles.push(a+e.styles[t])}))},loadResources:function(){lbs.loader.scripts=lbs.loader.scripts.filter(this.uniqueFilter),lbs.loader.styles=lbs.loader.styles.filter(this.uniqueFilter),lbs.loader.libs=lbs.loader.libs.filter(this.uniqueFilter),lbs.log.debug("Scripts to load:"+lbs.loader.scripts),lbs.log.debug("Styles to load: "+lbs.loader.styles),lbs.log.debug("Libs to load: "+lbs.loader.libs),$.each(lbs.loader.libs,function(e){lbs.loader.loadScript(lbs.loader.libs[e])}),$.each(lbs.loader.scripts,function(e){lbs.loader.loadScript(lbs.loader.scripts[e])}),$.each(lbs.loader.styles,function(e){lbs.loader.loadStyle(lbs.loader.styles[e])})},loadScript:function(filename){try{$.getScript(filename).done(function(e,o){lbs.log.info('Script "'+filename+'" loaded successfully')}).fail(function(e,o,a){throw a}),retval=!0}catch(e){try{lbs.log.info('Script "'+filename+'" could not be loaded, using fallback loading through LWS');var s="";if(s=lbs.common.executeVba("LBSHelper.loadHTTPResource,"+filename),!s||""===s)throw new Error('Script "'+filename+'" returned empty');with(window)window.eval(s);lbs.log.info('Script "'+filename+'" loaded successfully'),retval=!0}catch(e2){lbs.log.error('Script "'+filename+'" could not be loaded though browser',e),lbs.log.error('Script "'+filename+'" could not be loaded through LWS',e2),retval=!1}}return retval},loadStyle:function(e){$("<link/>",{rel:"stylesheet",type:"text/css",href:e}).appendTo("head")},loadView:function(e,o){try{e+=".html",o.load(e,function(t,n,s){-1!=t.indexOf("<script")?(lbs.log.error('View "'+e+'" containes scripts, it is not allowed to be loaded'),o.html('<img src="'+lbs.loader.systemLibPath+'img/YouDidntSayTheMagicWord.gif" />')):"error"==n?lbs.log.error('View "'+e+'" could not be loaded',a):lbs.log.info('View "'+e+'" loaded successfully')})}catch(a){lbs.log.warn("Resource could not be found. If using Chrome or IE11, make sure --file-access-from-file is enabled"),lbs.log.warn('View "'+e+'" could not be loaded, using fallback loading through LWS');var t="";t=lbs.common.executeVba("LBSHelper.loadHTTPResource,"+e),t&&""!==t?(o.html(t),lbs.log.info('View "'+e+'" loaded successfully')):lbs.log.error('View "'+e+'" could not be loaded',a)}},loadDataSources:function(e,o,a){if(!lbs.hasLimeConnection)return lbs.log.warn("No connecton, datasources will not be loaded"),e;var t=function(e){return"relatedRecord"!=e.type},n=function(e){return"activeInspector"!=e.type},s=function(e){return"activeInspector"===e.type},r=function(e){return"relatedRecord"===e.type},l=o.filter(t).length!=o.length,i=o.filter(n).length!=o.length;if(l&&!i)o=o.filter(t),lbs.log.warn("Failed to load datasource 'RelatedRecord', activeInspector is not loaded");else if(l){var c=o.filter(s)[0];c.relatedRecords=o.filter(r),o=o.filter(t).filter(n),o.push(c)}return $.each(o,function(o,t){e=lbs.loader.loadDataSource(e,t,a)}),e},loadDataSource:function(e,o,a){var t={};lbs.log.debug("Loading data source: "+o.type+":"+o.source);try{switch(o.type){case"activeInspector":try{if(!lbs.activeInspector)return lbs.log.warn("No activeinspecor, datasource will not be loaded"),e;t=lbs.loader.controlsToJSON(lbs.activeInspector.Controls,o.alias),dataNode=t[Object.keys(t)[0]],o.hasOwnProperty("relatedRecords")&&$.each(o.relatedRecords,function(o,a){dataNode.hasOwnProperty(a.source)?(a["class"]=dataNode[a.source]["class"],a.idrecord=dataNode[a.source].value,vmToAdd=a.alias?e:dataNode,a.alias=a.alias?a.alias:a.source,lbs.loader.loadDataSource(vmToAdd,a,!0)):lbs.log.warn("Failed to load datasource 'RelatedRecord', field '{0}' does not exist".format(a.source))})}catch(n){lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source,n)}break;case"xml":var s=[];o.hasOwnProperty("PassInspectorParam")&&o.PassInspectorParam&&lbs.activeInspector&&s.push(lbs.activeInspector.ID),t=lbs.common.executeVba(o.source,s),null!==t?t=lbs.loader.xmlToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"record":var s=[];o.hasOwnProperty("PassInspectorParam")&&o.PassInspectorParam&&lbs.activeInspector&&s.push(lbs.activeInspector.ID),t=lbs.common.executeVba(o.source,s),null!==t?t=lbs.loader.recordToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"records":var s=[];o.hasOwnProperty("PassInspectorParam")&&o.PassInspectorParam&&lbs.activeInspector&&s.push(lbs.activeInspector.ID),t=lbs.common.executeVba(o.source,s),null!==t?t=lbs.loader.recordsToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"localization":var r=lbs.common.executeVba("Localize.getDictionaryKeys"),l=lbs.common.executeVba("Localize.getDictionary"),i={},c={};l&&r?(i=lbs.loader.dictionaryToJSON(r,l,"loc"),$.each(i.loc,function(e,o){keysplit=e.split("$$"),c[keysplit[0]]=c[keysplit[0]]||{},c[keysplit[0]][keysplit[1]]=o}),t.localize=c):lbs.log.warn("Localization dictionary could not be loaded");break;case"storedProcedure":t=lbs.common.executeVba("lbsHelper.loadXmlFromStoredProcedure, {0}".format(o.source)),null!==t?t=lbs.loader.xmlToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"HTTPGetXml":t=lbs.loader.loadFromExternalWebService(o.source),null!==t?t=lbs.loader.xmlToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"SOAPGetXml":t=lbs.common.executeVba("LBSHelper.loadFromSOAP,"+o.source.url+","+o.source.action+","+o.source.xml),null!==t?t=lbs.loader.xmlToJSON(t,o.alias):lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source);break;case"relatedRecord":try{var s=[];s.push(o["class"]),s.push(o.idrecord),o.hasOwnProperty("view")&&s.push(o.view),o.idrecord?(record=lbs.common.executeVba("lbsHelper.loadRelatedRecord",s),t=lbs.loader.recordToJSON(record,o.alias)):(t=lbs.loader.emptyAliasJSON(o.alias),lbs.log.debug("RelatedRecord load is canceled, idrecord is NULL: "+o.type+":"+o.source))}catch(n){lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source,n)}break;case"AsyncPost":var d=o.parameters||{};$.support.cors=!0,t={},t[o.alias]=$.ajax({contentType:"application/json",data:JSON.stringify(d),dataType:"json",type:"POST",url:o.url,crossDomain:!0})}e=lbs.common.mergeOptions(e,t||{},a)}catch(n){lbs.log.warn("Failed to load datasource: "+o.type+":"+o.source,n)}return e},loadExternalConfig:function(e,o,a){var t={};return o.hasOwnProperty(a)&&(t=o[a],t.hasOwnProperty("dataSources")&&(e.dataSources=t.dataSources),t.hasOwnProperty("autorefresh")&&(e.autorefresh=t.autorefresh)),e},loadFromExternalWebService:function(e){return lbs.common.executeVba("lbsHelper.loadFromREST,"+e)},loadLocalFileToString:function(e){return lbs.common.executeVba("lbsHelper.loadHTTPResource,"+e)},saveLocalFile:function(e,o){lbs.common.executeVba("lbsHelper.saveFile,"+e,[o])},uniqueFilter:function(e,o,a){return a.lastIndexOf(e)===o},dictionaryToJSON:function(e,o,a){for(var t,n,s={},r={},a=a?a:"dictionarySource",l=1;l<=o.count;l++)t=e(l),n=o.item(t),s[t]=n;return r[a]=s,r},recordsToJSON:function(e,o){var a={};if(e){var t=e.Class.Name,n=e.Count,o=o?o:t;a[o]={},a[o].records=[];for(var s=1;n>=s;s++){var r=lbs.loader.recordToJSON(e.Item(s),"r");a[o].records.push(r.r)}}return a},recordToJSON:function(e,o){var a={};if(e){var t,n=e.Fields.Count,s=e.Class.Name,o=o?o:s;a[o]={};for(var r=1;n>=r;r++)t=e.Fields(r).Name,a[o][t]={},a[o][t].text=e.Text(r),"unknown"!=typeof e.Value(r)&&(a[o][t].value=e.Value(r)),16==e.Fields(r).Type&&(a[o][t]["class"]=e.Fields(r).LinkedField.Class.Name),lbs.limeVersion.comparable>lbs.common.parseVersion("10.8").comparable&&19==e.Fields(r).Type&&(a[o][t].key=e.GetOptionKey(r))}return a},emptyAliasJSON:function(e){var o={};return o[e]={},o},controlsToJSON:function(e,o){var a,t=e.Count,n=e.Class.Name,s={},o=o?o:n;s[o]={};for(var r=1;t>=r;r++)a=e(r).Field.Name,s[o][a]={},s[o][a].text=e(r).Text,s[o][a].value=e(r).Value,16==e(r).Field.Type&&(s[o][a]["class"]=e(r).Field.LinkedField.Class.Name),lbs.limeVersion.comparable>lbs.common.parseVersion("10.8")&&19==e(r).Field.Type&&(s[o][a].key=e(r).OptionKey);return s},xmlToJSON:function(e,o){var a={},o=o?o:"xmlSource";return a[o]=$.parseJSON(xml2json($.parseXML(e),"")),a},createUpdateTranslation:function(e,o,a,t){return lbs.common.executeVba("lbsHelper.CreateUpdateTranslation,",[e,o,a,t])}},lbs.apploader={appFactory:{},register:function(e,o){this.appFactory[e]=o,lbs.log.debug("App '{0}' has been succesfully registered".format(e))},identifyApps:function(){var path,raw,htmlNode,config,instanceConfig,binding,appName,instance,guid;return $("[data-app]").each(function(){try{try{eval("binding = "+$(this).attr("data-app")),appName=binding.app,instanceConfig=binding.config}catch(e1){throw e1.message="App definition invalid\n"+e1.message,e1}if(path="apps/"+appName+"/",htmlNode=$(this),guid=lbs.common.generateGuid(),!lbs.apploader.appFactory[appName]&&!lbs.loader.loadScript(path+"app.js"))throw new Error("Could not find app "+appName);instance=new lbs.apploader.appFactory[appName],instanceConfig&&(instance.config="function"==typeof instance.config?new instance.config(instanceConfig):lbs.common.mergeOptions(instance.config,instanceConfig,!0)),lbs.loader.pushResources(instance.config.resources,path),lbs.apps[guid]=lbs.apps[guid]||{},lbs.apps[guid].name=appName,lbs.apps[guid].path=path,lbs.apps[guid].node=htmlNode,lbs.apps[guid].instance=instance}catch(e){lbs.log.warn("Could not load app",e)}}),this},buildCarousel:function(){var ol,li,binding,type,height;$("[data-carousel]").each(function(i1,d1){try{try{eval("binding = "+$(this).attr("data-carousel")),height=binding.height,type=binding.type,$(this).height(height),$(this).attr({id:"carousel-"+i1,"data-ride":"carousel","data-interval":"0"}),$(this).addClass("carousel slide lime-carousel"),$(this).children().each(function(){$(this).addClass("carousel-item")}),$(this).append("<ol></ol>"),ol=$(this).find("ol"),$(this).append(lbs.common.carouselRight,lbs.common.carouselLeft),$(this).find("a").attr("data-target","#carousel-"+i1),$(this).children(".carousel-item").wrapAll("<div class='carousel-inner'></div>"),ol.addClass("carousel-indicators"),$(this).children(".carousel-inner").children(".carousel-item").each(function(e,o){$(this).addClass("item"),ol.append("<li></li>"),li=ol.find("li").last(),0===e&&($(this).addClass("active"),li.addClass("active black")),li.attr({"data-slide-to":e,"data-target":"#carousel-"+i1}),li.addClass("black")})}catch(r){lbs.log.warn("Carousel definition is not valid",r)}}catch(e){lbs.log.warn("Could not load carousel",e)}})},buildApps:function(){$.each(lbs.apps,function(e,o){var a={};a.localize=lbs.vm.localize,a=lbs.loader.loadDataSources(a,o.instance.config.dataSources),lbs.apps[e].vm=a})},initializeApps:function(){var e,o,a;$.each(lbs.apps,function(t,n){o=n.name,e=n.path,a=n.node,config=n.config,vm=lbs.apps[t].vm,lbs.loader.loadView(e+"app",a);try{vm=n.instance.initialize(a,vm),lbs.apps[t].vm=vm}catch(s){lbs.apps[t].vm=vm,lbs.log.error("Could not intialize app: "+o,s)}try{ko.applyBindings(vm,a.get(0))}catch(s){lbs.log.warn(lbs.common.nl2br("Binding of data to view failed for app: "+o+"\n Displaying mapping attributes")),lbs.log.exception(s)}})}};var lbs=lbs||{};lbs.common={getErrorText:function(){var e=Math.floor(5*Math.random()+1);switch(e){case 1:return"Oh snap!";case 2:return"Oh no!";case 3:return"God damit!";case 4:return"Holy guacamole!";case 5:return"Arghhhh!"}},iconTemplate:"<i class='fa fa-fw {0}'></i>",escapeHtml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},carouselRight:"<a class='right carousel-control' data-slide='next' role='button'><i class='fa fa-arrow-right'></i></a>",carouselLeft:"<a class='left carousel-control' data-slide='prev' role='button'><i class='fa fa-arrow-left'></i> </a>",createLimeLink:function(e,o){return"limecrm:"+e+"."+lbs.activeDatabase+"."+lbs.activeServer+"?"+o},getURLParameter:function(e){var o=decodeURI((RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1]);return"null"==o?null:o},executeVba:function(inString,params){try{if(!lbs.hasLimeConnection)return lbs.log.warn("No lime connection, will not exec VBA call:"+inString),null;var vbaline,inArgs=inString.split(",");if(params&&(inArgs=inArgs.concat(params)),inArgs.length>1){var args="";vbaline="lbs.limeDataConnection.Run('"+inArgs[0]+"', ";for(var i=1;i<inArgs.length;i++){for(inArgs[i]=String(inArgs[i]);" "===inArgs[i].charAt(0);)inArgs[i]=inArgs[i].substr(1);args+="'"+inArgs[i]+"'",i!=inArgs.length-1&&(args+=",")}return vbaline+=args+")",lbs.log.debug("Trying to execute VBA:"+vbaline),eval(vbaline)}return vbaline="lbs.limeDataConnection.Run('"+arguments[0]+"')",lbs.log.debug("Trying to execute VBA:"+vbaline),lbs.limeDataConnection.Run(arguments[0])}catch(e){return lbs.log.error("Failed to execute VBA:"+vbaline,e),null}},nl2br:function(e){return e.replace(/\n/g,"<br />")},nl2brIndent:function(e){return e.replace(/\n/g,"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")},brak2br:function(e){return e.replace(/{/g,"<br />").replace(/}/g,"<br />")},mergeOptions:function(e,o,a){return $.each(o,function(o,t){t&&(e[o]?e[o]instanceof Array&&t instanceof Array?e[o]=e[o].concat(t):a?(e[o]=t,lbs.log.debug("Key '{0}' in view model was overriden by dataload".format(o))):lbs.log.warn("Key '{0}' was not added to the view model. Key already exists".format(o)):e[o]=t)}),e},generateGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0,a="x"==e?o:3&o|8;return a.toString(16)})},parseVersion:function(e){var o=0,a=0,t=0,n=0,s=0,r=0,l=0;for(strVersion=e.split("."),l=0;l<strVersion.length&&3>l;l++)isNaN(strVersion[l])?lbs.log.error("Could not parse lime version number '{0}'".format(e)):0===l?(n=parseInt(strVersion[l]),o=1e4*n):1===l?(s=parseInt(strVersion[l]),a=1e3*s):2==l&&(r=parseInt(strVersion[l]),t=r);return{comparable:o+a+t,full:"{0}.{1}.{2}".format(n,s,r),major:n,nMinor:s,build:r}}},String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(o,a){return"undefined"!=typeof e[a]?e[a]:o})}),ko.defaultBindingProvider=ko.bindingProvider.instance,ko.bindingProvider.instance={nodeHasBindings:ko.defaultBindingProvider.nodeHasBindings,getBindings:function(e,o){var a;try{a=ko.defaultBindingProvider.getBindings(e,o),this.checkValue(a,"text",e),this.checkValue(a,"value",e),a=this.processDependentBindings(a)}catch(t){lbs.log.error(t.message),a=this.getDummyBindings(e),a=this.processDependentBindings(a)}return a},checkValue:function(e,o,a){if(e&&e.hasOwnProperty(o)&&!e[o]&&""!==e[o]&&e[o]!==!1&&0!==e[o])throw new ReferenceError("Unable to set binding '{0}'.\nBindings value: {1}\nMessage: Property is undefined".format(o,$(a).attr("data-bind")))},processDependentBindings:function(e){return e?(e.hasOwnProperty("text")&&e.hasOwnProperty("icon")&&""!==e.text&&(e.textWithIcon={icon:e.icon,text:e.text},delete e.text,delete e.icon),e):void 0},getDummyBindings:function(e){var o,a={};return o=new RegExp("text:[^,}]*").exec($(e).attr("data-bind")),o&&(a.text="Binding: "+o[0].split(":")[1].trim()),o=new RegExp("value:[^,}]*").exec($(e).attr("data-bind")),o&&(a.value="Binding: "+o[0].split(":")[1].trim()),o=new RegExp("icon:[^,}]*").exec($(e).attr("data-bind")),o&&(a.icon=o[0].split(":")[1].trim().replace(/\'/g,"")),a}},ko.bindingHandlers.textWithIcon={update:function(e,o,a,t,n){var s=ko.unwrap(o()),r=lbs.common.iconTemplate.format(s.icon);$(e).html(r+"<span></span>"),ko.bindingHandlers.text.update($(e).find("span").get(0),function(){return s.text},a,t,n)}},ko.bindingHandlers.limeLink={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba("shell,"+lbs.common.createLimeLink(ko.unwrap(o()["class"]),ko.unwrap(o().value)))}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.vba={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba(o())}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.showOnMap={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba("shell,https://www.google.com/maps?q="+ko.unwrap(o()).replace(/\r?\n|\r/g," "))}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.call={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba("shell,tel:"+ko.unwrap(o()))}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.openURL={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba("shell,"+ko.unwrap(o()))}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.appInvoke={init:function(e,o,a,t,n){var s=function(){return lbs.hasLimeConnection===!0?function(){Invoker.invokeWebApplication(ko.unwrap(o()))}:function(){alert("AppInvoker is not avalible outside of lime")}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.vbaVisible={init:function(e,o,a,t,n){var s=lbs.common.executeVba(ko.unwrap(o()));s?($(e).show(),$(e).removeClass("hidden")):($(e).hide(),$(e).addClass("hidden"))}},ko.bindingHandlers.email={init:function(e,o,a,t,n){var s=function(){return function(){lbs.common.executeVba("shell,mailto:"+ko.unwrap(o()))}};ko.bindingHandlers.click.init(e,s,a,t,n)}},ko.bindingHandlers.icon={init:function(e,o,a,t,n){var s=lbs.common.iconTemplate.format(ko.unwrap(o()));""!==$(e).text()&&$(e).text().substring(0,s.length)!=s&&($(e).prepend(s),e=$(e).get(0))}},ko.bindingHandlers.safeText={update:function(e,o,a){var t,n=ko.utils.unwrapObservable(o()),s=ko.utils.unwrapObservable(n.value),r=ko.utils.unwrapObservable(n.property),l=ko.utils.unwrapObservable(n["default"])||"";t=s?n.property?s[r]:s:l,ko.bindingHandlers.text.update(e,function(){return t})}},ko.bindingHandlers.href={update:function(e,o){
ko.bindingHandlers.attr.update(e,function(){return{href:o()}})}},ko.bindingHandlers.src={update:function(e,o){ko.bindingHandlers.attr.update(e,function(){return{src:o()}})}},ko.bindingHandlers.instantValue={init:function(e,o,a){var t=function(){return ko.utils.extend(a(),{valueUpdate:"afterkeydown"})};t.get=function(e){return"valueupdate"===e?"afterkeydown":a.get(e)},t.has=function(e){return"valueupdate"===e||a.has(e)},ko.bindingHandlers.value.init(e,o,t)},update:ko.bindingHandlers.value.update},ko.bindingHandlers.toggle={init:function(e,o){var a=o();ko.applyBindingsToNode(e,{click:function(){a(!a())}})}},ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.stopBinding=!0,ko.bindingHandlers.popover={init:function(e,o,a,t,n){var s,r,l,i,c,d;if("object"==typeof o()){switch(r="undefined"==typeof o().color?"blue":o().color,l="undefined"==typeof o().title?"Titel saknas":o().title,"undefined"==typeof o().placement?c="top":(c=o().placement,-1=="left,right,top,bottom".indexOf(o().placement)&&(c="top")),"undefined"==typeof o().trigger?d="hover":(d=o().trigger,-1=="hover,click".indexOf(o().trigger)&&(d="hover")),i="undefined"==typeof o().icon?"":'<i class="fa '+o().icon+'"></i>',o().type){case"error":r="red",i='<i class="fa fa-times"></i> ',l="Error";break;case"info":r="blue",i='<i class="fa fa-info-circle"></i> ',l="Information";break;case"warning":r="orange",i='<i class="fa fa-warning"></i> ',l="Warning";break;case"success":r="green",i='<i class="fa fa-check"></i> ',l="Success";break;case"custom":break;default:l="",s=o().text}l="<span>"+l+"</span>",s='<div><div class="message-header '+r+'">'+i+l+"</div>"+o().text+"</div>"}else s=o(),c="top",d="hover";$(e).attr({"data-toggle":"popover","data-container":"body","data-content":s,"data-placement":c}),$(e).popover({trigger:d,html:"true"})},update:function(e,o,a,t,n){var s,r,l,i,c,d;if("object"==typeof o()){switch(r="undefined"==typeof o().color?"blue":o().color,l="undefined"==typeof o().title?"Titel saknas":o().title,"undefined"==typeof o().placement?c="top":(c=o().placement,-1=="left,right,top,bottom".indexOf(o().placement)&&(c="top")),"undefined"==typeof o().trigger?d="hover":(d=o().trigger,-1=="hover,click".indexOf(o().trigger)&&(d="hover")),i="undefined"==typeof o().icon?"":'<i class="fa '+o().icon+'"></i>',o().type){case"error":r="red",i='<i class="fa fa-times"></i> ',l="Error";break;case"info":r="blue",i='<i class="fa fa-info-circle"></i> ',l="Information";break;case"warning":r="orange",i='<i class="fa fa-warning"></i> ',l="Warning";break;case"success":r="green",i='<i class="fa fa-check"></i> ',l="Success";break;case"custom":break;default:l="",s=o().text}s='<div><div class="message-header '+r+'">'+i+l+"</div>"+o().text+"</div>"}else s=o(),c="top",d="hover";$(e).attr({"data-toggle":"popover","data-container":"body","data-content":s,"data-placement":c})}},ko.bindingHandlers.tooltip={init:function(e,o,a,t,n){"object"==typeof o()?($(e).attr({"data-toggle":"tooltip","white-space":"nowrap","data-original-title":o().text,"data-placement":o().placement}),$(e).tooltip()):($(e).attr({"data-toggle":"tooltip","white-space":"pre-wrap","data-original-title":o(),"data-placement":"top"}),$(e).tooltip())},update:function(e,o,a,t,n){$(e).attr("object"==typeof o()?{"data-toggle":"tooltip","white-space":"pre-wrap","data-original-title":o().text,"data-placement":o().placement}:{"data-toggle":"tooltip","white-space":"pre-wrap","data-original-title":o(),"data-placement":"top"})}},ko.filters.number=function(e,o){return void 0===o&&(o=2),e=Number(Math.round(e+"e"+o)+"e-"+o),e.toLocaleString()},ko.filters.currency=function(e,o,a){return void 0===o&&(o="tkr"),void 0===a&&(a=1e3),e/=a,e=Number(Math.round(e+"e0")+"e-0"),e.toLocaleString()+o},ko.filters.percent=function(e,o){return 100*e+"%"},ko.filters.fromNow=function(e,o){return e=e.slice(0,19),moment(e).fromNow(!0)},ko.bindingHandlers.rotate={update:function(e,o,a,t,n){var s=o();console.log(s),$(e).css({"-webkit-transform":"rotate("+s+"deg)","-moz-transform-transform":"rotate("+s+"deg)","-ms-transform-transform":"rotate("+s+"deg)","-o-transform:":"rotate("+s+"deg)","transform:":"rotate("+s+"deg)"})}},lbs.jotnar={winterEgg:function(){var e=moment(),o="2014-12-19",a="2015-01-05",t=moment(e).diff(moment(o,"YYYY-MM-DD")),n=moment(e).diff(moment(a,"YYYY-MM-DD"));t>0&&0>n?snowStorm.freezeOnBlur=!1:snowStorm.freeze()}};